services:
  app:
    build: .
    ports:
      - "8081:8080"
    environment:
      - NODE_ENV=production
      - DB_PROVIDER=${DB_PROVIDER:-sqlite}
      - SQLITE_FILE=${SQLITE_FILE:-/data/fauxdash.db}
      - REDIS_ENABLED=${REDIS_ENABLED:-true}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      - NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:8081}
    volumes:
      - fauxdash-data:/data
      - fauxdash-favicons:/app/public/favicons
      - fauxdash-logs:/data/logs
    depends_on:
      - redis
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    restart: unless-stopped

  # Optional: PostgreSQL (uncomment if using postgres)
  # postgres:
  #   image: postgres:16-alpine
  #   environment:
  #     POSTGRES_DB: fauxdash
  #     POSTGRES_USER: fauxdash
  #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-changeme}
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   restart: unless-stopped

  # Optional: MySQL (uncomment if using mysql)
  # mysql:
  #   image: mysql:8
  #   environment:
  #     MYSQL_DATABASE: fauxdash
  #     MYSQL_USER: fauxdash
  #     MYSQL_PASSWORD: ${MYSQL_PASSWORD:-changeme}
  #     MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-changeme}
  #   volumes:
  #     - mysql-data:/var/lib/mysql
  #   restart: unless-stopped

volumes:
  fauxdash-data:
  fauxdash-favicons:
  fauxdash-logs:
  redis-data:
  # postgres-data:
  # mysql-data:
